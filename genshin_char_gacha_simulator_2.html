
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åŸç¥ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 1em; color: #333; }
    .container { max-width: 600px; margin: auto; background: #fff; padding: 1em; border-radius: 8px; }
    h1 { font-size: 1.5em; margin-bottom: 0.5em; }
    label { display: block; margin-top: 1em; }
    input[type='number'], input[type='date'] {
      width: 100%; padding: 0.5em; margin-top: 0.3em;
    }
    button { padding: 0.75em; font-weight: bold; cursor: pointer; }
    .result { margin-top: 2em; padding: 1em; background: #f9f9f9; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: center; }
    th { background: #f0f0f0; }
    .note { font-size: 0.9em; color: #666; margin-top: 1em; }
    .btns { display: flex; gap: 1em; margin-top: 1.5em; }
    h2 { margin-top: 1.5em; font-size: 1.1em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>åŸç¥ã‚­ãƒ£ãƒ©ã‚¬ãƒãƒ£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p>æœŸå¾…å€¤ï¼ˆå¹³å‡ï¼‰ã¨æœ€æ‚ªã®å ´åˆã‚’æ¯”è¼ƒã—ã€åŸçŸ³ãƒ»èª²é‡‘é¡ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™ã€‚</p>

    <h2>ğŸ“¦ æ‰€æŒæƒ…å ±</h2>
    <label>æ‰‹æŒã¡åŸçŸ³:
      <input type="number" id="primogems" value="0">
    </label>
    <label>ç´¡ãŒã‚ŒãŸé‹å‘½ï¼ˆæ‰€æŒæ•°ï¼‰:
      <input type="number" id="fates" value="0">
    </label>
    <label>ç©ºæœˆã®ç¥ç¦ã‚’è³¼å…¥ã—ã¦ã„ã‚‹:
      <input type="checkbox" id="welkin">
    </label>

    <h2>ğŸ¯ ã‚¬ãƒãƒ£çŠ¶æ…‹</h2>
    <label>ç¾åœ¨ã®ã‚­ãƒ£ãƒ©ã‚¬ãƒãƒ£ç¥ˆé¡˜å›æ•°:
      <input type="number" id="currentPulls" value="0">
    </label>
    <label>å‰å›ã™ã‚ŠæŠœã‘ãŸï¼ˆæ¬¡ãŒPUç¢ºå®šï¼‰:
      <input type="checkbox" id="guaranteed">
    </label>
    <label>ã‚¬ãƒãƒ£çµ‚äº†æ—¥:
      <input type="date" id="endDate">
    </label>

    <h2>ğŸ† ç›®æ¨™</h2>
    <label>ç›®æ¨™PUã‚­ãƒ£ãƒ©æ•°:
      <input type="number" id="targetPU" value="1" min="1">
    </label>

    <div class="btns">
      <button onclick="simulate()" style="flex: 1;">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
      <button onclick="clearForm()" style="flex: 1;">ã‚¯ãƒªã‚¢</button>
    </div>

    <div class="result" id="result"></div>

    <div class="note">
      â€»æ˜Ÿ5æ’å‡ºç‡ã¯1ã€œ73é€£:0.6%ã€74é€£ã€œ:1é€£ã”ã¨ã«+6%ï¼ˆæœ€å¤§90é€£ã§100%ï¼‰ã§è¨ˆç®—ã€‚<br>
      â€»PUç¢ºç‡ã¯50%ã€æ´ã¿ã—æ˜å…‰ï¼ˆã™ã‚ŠæŠœã‘3é€£ç¶šã§PUåŒ–ï¼‰å¯¾å¿œæ¸ˆã¿ã€‚<br>
      â€»èª²é‡‘é¡ã¯ã€Œ12,000å††ã§8,080åŸçŸ³ï¼ˆã‚ªãƒã‚±è¾¼ã¿ï¼‰ã€ã§ç®—å‡ºã€‚
    </div>
  </div>

  <script>
    function getStar5Probability(pity) {
      if (pity <= 73) return 0.006;
      if (pity < 90) return 0.006 + 0.06 * (pity - 73);
      return 1.0;
    }

    function simulateExpectedPU(targetPU, guaranteedStart) {
      const trials = 10000;
      let results = [];

      for (let i = 0; i < trials; i++) {
        let pulls = 0, puCount = 0;
        let pity = 0;
        let guaranteed = guaranteedStart;
        let missStreak = guaranteed ? 0 : 1;

        while (puCount < targetPU) {
          pity++;
          pulls++;
          if (Math.random() < getStar5Probability(pity)) {
            pity = 0;
            if (missStreak >= 3) {
              puCount++;
              guaranteed = false;
              missStreak = 0;
            } else if (guaranteed || Math.random() < 0.5) {
              puCount++;
              guaranteed = false;
              missStreak = 0;
            } else {
              guaranteed = true;
              missStreak++;
            }
          }
        }

        results.push(pulls);
      }

      return Math.round(results.reduce((a, b) => a + b, 0) / trials);
    }

    function simulate() {
      const primogems = parseInt(document.getElementById("primogems").value) || 0;
      const fates = parseInt(document.getElementById("fates").value) || 0;
      const welkin = document.getElementById("welkin").checked;
      const currentPulls = parseInt(document.getElementById("currentPulls").value) || 0;
      const guaranteed = document.getElementById("guaranteed").checked;
      const targetPU = parseInt(document.getElementById("targetPU").value) || 1;
      const endDateRaw = document.getElementById("endDate").value;
      const today = new Date();
      const endDate = endDateRaw ? new Date(endDateRaw) : today;
      const daysLeft = Math.max(0, Math.floor((endDate - today) / (1000 * 60 * 60 * 24)));

      const fatePrimogems = fates * 160;
      const futurePrimogems = daysLeft * (welkin ? 150 : 60);
      const totalPrimogems = primogems + fatePrimogems + futurePrimogems;
      const totalPulls = Math.floor(totalPrimogems / 160) + currentPulls;

      // æœ€æ‚ªã‚±ãƒ¼ã‚¹
      let worstPulls = 0, puCount = 0;
      let streak = guaranteed ? 0 : 1;
      let nextGuaranteed = guaranteed;
      while (puCount < targetPU) {
        if (streak >= 3) {
          worstPulls += 90;
          puCount++;
          streak = 0;
          nextGuaranteed = false;
        } else if (nextGuaranteed) {
          worstPulls += 90;
          puCount++;
          nextGuaranteed = false;
        } else {
          worstPulls += 180;
          puCount++;
          streak++;
          nextGuaranteed = false;
        }
      }

      // æœŸå¾…å€¤ï¼ˆãƒªã‚¢ãƒ«æ’å‡ºç‡å¯¾å¿œï¼‰
      const expectedPulls = simulateExpectedPU(targetPU, guaranteed);

      const shortExpected = Math.max(0, expectedPulls - totalPulls);
      const shortWorst = Math.max(0, worstPulls - totalPulls);

      const gemExpected = shortExpected * 160;
      const gemWorst = shortWorst * 160;

      const yenExpected = Math.ceil((gemExpected / 8080) * 12000);
      const yenWorst = Math.ceil((gemWorst / 8080) * 12000);

      document.getElementById("result").innerHTML = `
        <h2>åŸçŸ³çŠ¶æ³</h2>
        <ul>
          <li>åŸçŸ³: ${primogems}å€‹</li>
          <li>ç´¡ãŒã‚ŒãŸé‹å‘½: ${fates}å€‹ï¼ˆ= ${fatePrimogems}åŸçŸ³ï¼‰</li>
          ${endDateRaw ? `<li>ä»Šå¾Œã®ãƒ­ã‚°ã‚¤ãƒ³åŸçŸ³: ${futurePrimogems}å€‹ï¼ˆ${daysLeft}æ—¥åˆ†ï¼‰</li>` : ""}
          <li><strong>åˆè¨ˆè¦‹è¾¼ã¿åŸçŸ³æ•°: ${totalPrimogems}å€‹ï¼ˆ${totalPulls}å›ï¼‰</strong></li>
        </ul>
        <h2>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ</h2>
        <table>
          <tr><th>é …ç›®</th><th>æœŸå¾…å€¤ï¼ˆå¹³å‡ï¼‰</th><th>æœ€æ‚ªã®å ´åˆ</th></tr>
          <tr><td>å¿…è¦ç¥ˆé¡˜æ•°</td><td>${expectedPulls}å›</td><td>${worstPulls}å›</td></tr>
          <tr><td>ä¸è¶³ç¥ˆé¡˜æ•°</td><td>${shortExpected}å›</td><td>${shortWorst}å›</td></tr>
          <tr><td>ä¸è¶³åŸçŸ³æ•°</td><td>${gemExpected}</td><td>${gemWorst}</td></tr>
          <tr><td>èª²é‡‘é¡ã®ç›®å®‰</td><td>Â¥${yenExpected.toLocaleString()}</td><td>Â¥${yenWorst.toLocaleString()}</td></tr>
        </table>
      `;
    }
  
    function clearForm() {
      document.getElementById("primogems").value = 0;
      document.getElementById("fates").value = 0;
      document.getElementById("welkin").checked = false;
      document.getElementById("currentPulls").value = 0;
      document.getElementById("guaranteed").checked = false;
      document.getElementById("endDate").value = "";
      document.getElementById("targetPU").value = 1;
      document.getElementById("result").innerHTML = "";
    }
    </script>
</body>
</html>
