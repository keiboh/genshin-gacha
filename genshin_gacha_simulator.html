
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原神ガチャ期待値計算</title>
    <style>
        body { font-family: sans-serif; padding: 1em; background-color: #f5f5f5; color: #333; }
        label { display: block; margin-top: 1em; }
        input, select { width: 100%; padding: 0.5em; margin-top: 0.2em; }
        button { margin-top: 1.5em; padding: 0.75em; width: 100%; font-weight: bold; }
        .result { margin-top: 2em; padding: 1em; background: #fff; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>原神ガチャ期待値計算</h1>

    <label>
        空月の祝福を購入している:
        <input type="checkbox" id="welkin" />
    </label>

    <label>
        手持ち原石:
        <input type="number" id="primogems" value="0" />
    </label>

    <label>
        紡がれた運命（所持数）:
        <input type="number" id="fates" value="0" />
    </label>

    <label>
        現在のキャラガチャ祈願回数（★5が出るまでの累積）:
        <input type="number" id="charPulls" value="0" />
    </label>

    <label>
        すり抜けだった？（前回★5）:
        <select id="lastLost">
            <option value="yes">はい（すり抜け）</option>
            <option value="no">いいえ（PU）</option>
        </select>
    </label>

    <label>
        「掴みし明光」で何回連続すり抜けした？:
        <input type="number" id="missCount" value="0" />
    </label>

    <label>
        ガチャ開始日:
        <input type="date" id="startDate" />
    </label>

    <label>
        ガチャ終了日:
        <input type="date" id="endDate" />
    </label>

    <button onclick="calculate()">計算する</button>

    <div class="result" id="result"></div>

    <script>
        function calculate() {
            const welkin = document.getElementById("welkin").checked;
            const primogems = parseInt(document.getElementById("primogems").value) || 0;
            const fates = parseInt(document.getElementById("fates").value) || 0;
            const charPulls = parseInt(document.getElementById("charPulls").value) || 0;
            const lastLost = document.getElementById("lastLost").value === "yes";
            const missCount = parseInt(document.getElementById("missCount").value) || 0;
            const startDate = new Date(document.getElementById("startDate").value);
            const endDate = new Date(document.getElementById("endDate").value);

            const today = new Date();
            const daysLeft = Math.max(0, Math.floor((endDate - today) / (1000 * 60 * 60 * 24)));

            let dailyPrimogems = 60; // デイリー任務
            if (welkin) dailyPrimogems += 90; // 空月

            const futurePrimogems = daysLeft * dailyPrimogems;
            const totalPrimogems = primogems + futurePrimogems + (fates * 160);
            const pullsAvailable = Math.floor(totalPrimogems / 160);

            // キャラ2回PU（PU確定済みと仮定）→ 最大180回、期待値150回
            const charNeeded = 150;
            const pullsShort = Math.max(0, charNeeded - (pullsAvailable + charPulls));
            const primogemsNeeded = pullsShort * 160;
            const yenNeeded = Math.ceil((primogemsNeeded / 6480) * 12000);

            const result = document.getElementById("result");
            result.innerHTML = `
                <h2>結果</h2>
                <p>残り日数: ${daysLeft}日</p>
                <p>合計引ける回数（見込み）: ${pullsAvailable + charPulls}回</p>
                <p>★5キャラ（PU）2回 引くにはあと <strong>${pullsShort}回</strong> 必要</p>
                <p>追加原石: ${primogemsNeeded}個</p>
                <p><strong>想定課金額: 約 ${yenNeeded.toLocaleString()} 円</strong></p>
            `;
        }
    </script>
</body>
</html>
